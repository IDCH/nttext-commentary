<!DOCTYPE HTML>
<html>
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>Insert title here</title>
  
  <script type="text/javascript">
      
    function BookName(osisId, name, alternateSpellings) {
        this.osisId = osisId;
        this.name = name; 
        this.alternateSpellings = alternateSpellings;
    }
  
    function BookOrder() {
        this.books = [];
    }
    
    BookOrder.prototype.addBook = function(bookName) {
        this.books.push(bookName);
    };
    
    var RefSystem = {
        Bible : {
            NRSVA : new BookOrder()
        }
    };
    
    
    //====================================================================================
    // INITIALIZE THE NRSVA BookOrder
    //====================================================================================
    
    RefSystem.Bible.NRSVA.addBook(new BookName("Gen", "Genesis",            ["Gen", "Ge", "Gn"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Exod", "Exodus",            ["Exo", "Ex", "Exod"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Lev", "Leviticus",          ["Lev", "Le", "Lv"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Num", "Numbers",            ["Num", "Nu", "Nm", "Nb"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Deut", "Deuteronomy",       ["Deut", "Dt"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Josh", "Joshua",            ["Josh", "Jos", "Jsh"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Judg", "Judges",            ["Judg", "Jdg", "Jg", "Jdgs"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Ruth", "Ruth",              ["Rth", "Ru"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("1Sam", "1 Samuel",          ["1 Sam", "1 Sa", "1Samuel", "1S", "I Sa", "1 Sm", "1Sa", "I Sam", "1Sam", "I Samuel", "1st Samuel", "First Samuel"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("2Sam", "2 Samuel",          ["2 Sam", "2 Sa", "2S", "II Sa", "2 Sm", "2Sa", "II Sam", "2Sam", "II Samuel", "2Samuel", "2nd Samuel", "Second Samuel"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("1Kgs", "1 Kings",           ["1 Kgs", "1 Ki", "1K", "I Kgs", "1Kgs", "I Ki", "1Ki", "I Kings", "1Kings", "1st Kgs", "1st Kings", "First Kings", "First Kgs", "1Kin"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("2Kgs", "2 Kings",           ["2 Kgs", "2 Ki", "2K", "II Kgs", "2Kgs", "II Ki", "2Ki", "II Kings", "2Kings", "2nd Kgs", "2nd Kings", "Second Kings", "Second Kgs", "2Kin"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("1Chr", "1 Chronicles",      ["1 Chron", "1 Ch", "I Ch", "1Ch", "1 Chr", "I Chr", "1Chr", "I Chron", "1Chron", "I Chronicles", "1Chronicles", "1st Chronicles", "First Chronicles"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("1Chr", "2 Chronicles",      ["2 Chron", "2 Ch", "II Ch", "2Ch", "II Chr", "2Chr", "II Chron", "2Chron", "II Chronicles", "2Chronicles", "2nd Chronicles", "Second Chronicles"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Ezra", "Ezra",              ["Ezra", "Ezr"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Neh", "Nehemiah",           ["Neh", "Ne"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Esth", "Esther",            ["Esth", "Es"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Job", "Job",                ["Job", "Job", "Jb"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Ps", "Psalm",               ["Pslm", "Ps", "Psalms", "Psa", "Psm", "Pss"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Prov", "Proverbs",          ["Prov", "Pr", "Prv"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Eccl", "Ecclesiastes",      ["Eccles", "Ec", "Qoh", "Qoheleth"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Song", "Song of Solomon",   ["Song", "So", "Canticle of Canticles", "Canticles", "Song of Songs", "SOS"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Isa", "Isaiah",             ["Isa", "Is"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Jer", "Jeremiah",           ["Jer", "Je", "Jr"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Lam", "Lamentations" ,      ["Lam", "La"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Ezek", "Ezekiel",           ["Ezek", "Eze", "Ezk"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Dan", "Daniel",             ["Dan", "Da", "Dn"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Hos", "Hosea",              ["Hos", "Ho"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Joel", "Joel",              ["Joel", "Joe", "Jl"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Amos", "Amos",              ["Amos", "Am"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Obad", "Obadiah",           ["Obad", "Ob"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Jonah", "Jonah",            ["Jnh", "Jon"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Mic", "Micah",              ["Micah", "Mic"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Nah", "Nahum",              ["Nah", "Na"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Hab", "Habakkuk",           ["Hab", "Hab"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Zeph", "Zephaniah",         ["Zeph", "Zep", "Zp"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Hag", "Haggai",             ["Haggai", "Hag", "Hg"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Zech", "Zechariah",         ["Zech", "Zec", "Zc"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Mal", "Malachi",            ["Mal", "Mal", "Ml"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Matt", "Matthew",           ["Matt", "Mt"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Mark", "Mark",              ["Mrk", "Mk", "Mr"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Luke", "Luke",              ["Luk", "Lk"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("John", "John",              ["John", "Jn", "Jhn"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Acts", "Acts",              ["Acts", "Ac"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Rom", "Romans",             ["Rom", "Ro", "Rm"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("1Cor", "1 Corinthians",     ["1 Cor", "1 Co", "I Co", "1Co", "I Cor", "1Cor", "I Corinthians", "1Corinthians", "1st Corinthians", "First Corinthians"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("2Cor", "2 Corinthians",     ["2 Cor", "2 Co", "II Co", "2Co", "II Cor", "2Cor", "II Corinthians", "2Corinthians", "2nd Corinthians", "Second Corinthians"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Galatians",                 ["Gal", "Ga"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Eph", "Ephesians",          ["Ephes", "Eph"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Phil", "Philippians",       ["Phil", "Php"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Col", "Colossians",         ["Col", "Col"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("1Thess", "1 Thessalonians", ["1 Thess", "1 Th", "I Th", "1Th", "I Thes", "1Thes", "I Thess", "1Thess", "I Thessalonians", "1Thessalonians", "1st Thessalonians", "First Thessalonians"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("2Thess", "2 Thessalonians", ["2 Thess", "2 Th", "II Th", "2Th", "II Thes", "2Thes", "II Thess", "2Thess", "II Thessalonians", "2Thessalonians", "2nd Thessalonians", "Second Thessalonians"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("1Tim", "1 Timothy",         ["1 Tim", "1 Ti", "I Ti", "1Ti", "I Tim", "1Tim", "I Timothy", "1Timothy", "1st Timothy", "First Timothy"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("1Tim", "2 Timothy",         ["2 Tim", "2 Ti", "II Ti", "2Ti", "II Tim", "2Tim", "II Timothy", "2Timothy", "2nd Timothy", "Second Timothy"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Titus", "Titus",            ["Titus", "Tit"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Phlm", "Philemon",          ["Philem", "Phm"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Heb", "Hebrews",            ["Hebrews", "Heb"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Jas", "James",              ["James", "Jas", "Jm"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("1Pet", "1 Peter",           ["1 Pet", "1 Pe", "I Pe", "1Pe", "I Pet", "1Pet", "I Pt", "1 Pt", "1Pt", "I Peter", "1Peter", "1st Peter", "First Peter"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("2Pet", "2 Peter",           ["2 Pet", "2 Pe", "II Pe", "2Pe", "II Pet", "2Pet", "II Pt", "2 Pt", "2Pt", "II Peter", "2Peter", "2nd Peter", "Second Peter"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("1John", "1 John",           ["1 John", "1 Jn", "I Jn", "1Jn", "I Jo", "1Jo", "I Joh", "1Joh", "I Jhn", "1 Jhn", "1Jhn", "I John", "1John", "1st John", "First John"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("2John", "2 John",           ["2 John", "2 Jn", "II Jn", "2Jn", "II Jo", "2Jo", "II Joh", "2Joh", "II Jhn", "2 Jhn", "2Jhn", "II John", "2John", "2nd John", "Second John"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("3John", "3 John",           ["3 John", "3 Jn", "III Jn", "3Jn", "III Jo", "3Jo", "III Joh", "3Joh", "III Jhn", "3 Jhn", "3Jhn", "III John", "3John", "3rd John", "Third John"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Jude","Jude",               ["Jude", "Jud"]));
    RefSystem.Bible.NRSVA.addBook(new BookName("Rev", "Revelation",         ["Rev", "Re", "The Revelation"]));
    
    
    //====================================================================================
    // REFERENCE PARSER CLASS
    //====================================================================================
    
    
    function ReferenceParser(bookOrder) {
        this.bookOrder = bookOrder;
        this.regExs = {};
    }
    
    ReferenceParser.prototype.parse = function(ref) {
    	var parts = ref.replace(/^\s*|\s*$/g, '').replace(/–|—/g, "-").split(/\s*-+\s*/);
    	var chapterVersePattern = /(\d+)(?:\D+(\d+)(?:\s*,\s*(\d+))?)?/;
    	
    	var osisRef = "";
        var startBook = null;
        var startChapter = 0;
        var startVerse = 0;
        
        var endBook = null;
        var endChapter = 0;
        var endVerse = 0;
        
    	// parse the starting reference
    	var firstRef = parts[0];
    	for (var bk in this.regExs) {
    		var re = this.regExs[bk];
    		
    		if (re.test(firstRef)) {
    			startBook = bk;
                firstRef = firstRef.replace(re, "");
                
                // parse out chapter
                if (chapterVersePattern.test(firstRef)) {
                	nums = chapterVersePattern.exec(firstRef);
                    startChapter = parseInt(nums[1]);
                    
                    // verse
                    if (nums[2]) {
                        startVerse = parseInt(nums[2]);
                    }
                    
                    // if a comma is separating two verse then honor that
                    if (nums[3]) {
                        endBook = startBook;
                        endChapter = startChapter;
                        endVerse = parseInt(nums[3]);
                        if (endVerse != startVerse + 1)
                            endVerse = 0;
                    }
                }
                
    			break;   // found a book for the first reference
    		}
    	}                // end for loop to parse first reference
    	
    	// build the reference
    	if (!startBook) {
            return "";
        }
        
        osisRef = startBook;
        if (startChapter != 0)
            osisRef += "." + startChapter;
        if (startVerse != 0)
            osisRef += "." + startVerse;
        
        if (parts[1]) {
        	var secondRef = parts[1];
        	// look for the second book name
        	for (var bk in this.regExs) {
                var re = this.regExs[bk];
                
                if (re.test(secondRef)) {
                	endBook = bk;
                	secondRef = secondRef.replace(re, "");
                }
        	}
        	
        	// look for ending chapter and verse
        	if (chapterVersePattern.test(secondRef)) {
        		var nums = chapterVersePattern.exec(secondRef);
        		
        		// if only one number and the ending book isn't specified, this is a verse
        		if (!nums[2] && !endBook) {
        			if (startVerse > 0) {
                        // if a verse is specified in start ref, then the number is a verse
                        endChapter = startChapter;
                        endVerse = parseInt(nums[1]);
                    } else { 
                        // if only the chapter is specified, then the number is a chapter
                        endChapter = parseInt(nums[1]);
                    }
        		} else {
        			// either the book is supplied or a chapter and verse are supplied
                    // in this case, don't adopt anything from the start ref
                    endChapter = parseInt(nums[1]);
                    if (nums[2]) {
                        endVerse = parseInt(nums[2]);
                    }
        		}
        	}      // done looking for ending chapter and verse
        	
        	if (!endBook) {
                endBook = startBook;
            }
        }   // done looking for end reference
        
        if (endBook) {
            osisRef += "-" + endBook;
            if (endChapter > 0) 
                osisRef += "." + endChapter;

            if (endVerse > 0) 
                osisRef += "." + endVerse;
        }
        
        return osisRef;
    };    
    
    ReferenceParser.prototype.addRegEx = function(osisId, regEx) {
        this.regExs[osisId] = regEx;
    };
    
    
    var parser = new ReferenceParser();
    parser.addRegEx("1Cor",    /^[1I]\s*C\D*/i); 
    parser.addRegEx("1John",   /^[1I]\s*J\D*/i);
    parser.addRegEx("1Pet",    /^[1I]\s*P\D*/i);
    parser.addRegEx("1Thess",  /^[1I]\s*Th\D*/i);
    parser.addRegEx("1Tim",    /^[1I]\s*T[im]\D*/i);
    parser.addRegEx("2Cor",    /^(?:2|II)\s*C\D*/i);
    parser.addRegEx("2John",   /^(?:2|II)\s*J\D*/i);
    parser.addRegEx("2Pet",    /^(?:2|II)\s*P\D*/i); 
    parser.addRegEx("2Thess",  /^(?:2|II)\s*Th\D*/i); 
    parser.addRegEx("2Tim",    /^(?:2|II)\s*T[im]\D*/i);
    parser.addRegEx("3John",   /^(?:3|III)\s*J\D*/i); 
    parser.addRegEx("Acts",    /^A\D*/i); 
    parser.addRegEx("Col",     /^C\D*/i); 
    parser.addRegEx("Eph",     /^E\D*/i); 
    parser.addRegEx("Gal",     /^G\D*/i); 
    parser.addRegEx("Heb",     /^H\D*/i); 
    parser.addRegEx("Jas",     /^J[mas]\D*/i);
    parser.addRegEx("John",    /^Jo?[hn]\D*/i);
    parser.addRegEx("Jude",    /^Ju\D*/i); 
    parser.addRegEx("Luke",    /^L\D*/i); 
    parser.addRegEx("Mark",    /^Ma?[rk]\D*/i);
    parser.addRegEx("Matt",    /^Ma?t?t\D*/i);
    parser.addRegEx("Phlm",    /^Ph\w*m\D*/i);
    parser.addRegEx("Phil",    /^Ph(il|\w*p)\D*/i);
    parser.addRegEx("Phil",    /^Ph\D*/i);
    parser.addRegEx("Rev",     /^R[ev]\D*/i);
    parser.addRegEx("Rom",     /^R[om]\D*/i);
    parser.addRegEx("Titus",   /^T\D*/i);
    
    function checkPassage(expected, test) {
        var result = parser.parse(test);
        //alert(result);
        if (result != expected) {
        	alert("Expected: " + expected + " Found: " + result);
        }
    	
    }
    
    checkPassage("1John.3.1-1John.3.2", "1 John 3:1,2");
    checkPassage("1John.3.2-1John.3.3", "1 John 3:2-1 John 3:3");
    checkPassage("1John.3-1John.4", "1 John 3-1 John 4");
    checkPassage("1John.1.2-1John.4.2", "1 John 1:2-1 John 4:2");
    checkPassage("1John.1.2-1John.1.8", "1 John 1:2-8");
    checkPassage("1John.1.2-1John.2.8", "1 John 1:2-2:8");
    
  </script>
  </head>
  
  <body>
  
  </body>
</html>